<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta property="og:title" content="화홍고 시간표 및 급식" />
    <meta property="og:description" content="10217 이한결" />
    <meta property="og:image" content="previewimage.png" />
    <meta property="og:url" content="https://hwahong.pages.dev" />
    <meta property="og:type" content="website" />
    <meta
      property="og:site_name"
      content="hwahong High School Timetable and Mealtable"
    />
    <meta property="og:locale" content="ko_KR" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap"
      rel="stylesheet"
    />

    <title>화홍고 시간표 및 급식</title>
    <style>
      body {
        background-color: #fefefe;
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        padding: 0px;
        border-radius: 0px;
        overflow-x: hidden;
        overflow-y: auto;
        font-size: 16px;
      }

      .gowun-dodum-regular {
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        font-weight: 400;
        font-style: normal;
      }

      h1 {
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        font-size: 24px;
        margin-left: 5px;
        margin-bottom: 0%;
        padding: 10px;
      }

      .form-element {
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        margin-right: 0%;
        margin-left: 0%;
        color: #666666;
        padding: 5px;
        display: inline-block;
      }

      .form-button {
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        padding: 4px 9px;
        border: 1px solid #cccccc;
        border-radius: 5px;
        background-color: #0066ff;
        color: #ffffff;
        font-size: 16px;
        margin-right: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        text-align: center;
        vertical-align: middle;
      }

      .form-button:hover {
        background-color: #f49044;
      }

      .styled-select {
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        padding: 4px;
        border: 1px solid #cccccc;
        border-radius: 5px;
        background-color: #fefeff;
        font-size: 18px;
        margin-right: 5px;
        color: #333333;
        vertical-align: middle;
      }

      div {
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        list-style-type: none;
        padding-left: 5px;
      }

      ul {
        list-style-type: none;
        padding: 0;
      }

      li {
        margin-bottom: 5px;
      }

      .date-display {
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        color: #666666;
        padding-left: 15px;
        padding-bottom: 10px;
      }

      .name {
        font-family: "Gowun Dodum", sans-serif;
        font-weight: bold;
        font-size: 12px;
        margin: 20px;
        padding-left: 15px;
      }

      table {
        width: 20080206%; /* 한결이 생일 */
        height: 20081206%; /* 은찬이 생일 */
        max-width: 500px;
        max-height: 500px;
        border-collapse: separate;
        border-spacing: 5px;
        border-radius: 5px;
        overflow: hidden;
        text-align: center;
      }

      td {
        border: 1px solid #cccccc;
        padding: 3px;
        text-align: center;
        border-radius: 10px;
        width: 200px;
        height: 50px;
      }

      th {
        background-color: #f0f0f0;
        border: 1px solid #cccccc;
        padding: 3px;
        text-align: center;
        border-radius: 10px;
        width: 200px;
        height: 50px;
      }

      .small-cell {
        width: 10%;
      }

      .large-cell {
        width: 20%;
      }

      .scpg {
        text-decoration-line: none;
        padding-left: 5px;
        padding-right: 5px;
        padding-top: 10px;
        font-family: "Gowun Dodum", sans-serif;
        font-size: 15px;
      }

      .scpg:link {
        color: #9999ff;
        text-decoration: none;
      }

      .scpg:visited {
        color: #9999ff;
        text-decoration: none;
      }

      .scpg:hover {
        color: #99eeff;
        text-decoration: none;
      }

      .scpg:active {
        color: #99eeff;
        text-decoration: none;
      }
    </style>
  </head>

  <body>
    <button class="form-button" onclick="navigateToDSP()">
      데일리 스터디 플레너
    </button>
    <button class="form-button" onclick="navigateToNEW()">새로운 버전</button>
    <h1>시간표 및 급식</h1>
    <div id="current-date" class="date-display"></div>
    <form id="schedule-form">
      <label for="grade" class="form-element">학년:</label>
      <select id="grade" class="styled-select">
        <option value="1">1학년</option>
        <option value="2">2학년</option>
        <option value="3">3학년</option>
      </select>
      <label for="class_num" class="form-element">반:</label>
      <select id="class_num" class="styled-select">
        <option value="1">1반</option>
        <option value="2">2반</option>
        <option value="3">3반</option>
        <option value="4">4반</option>
        <option value="5">5반</option>
        <option value="6">6반</option>
        <option value="7">7반</option>
        <option value="8">8반</option>
        <option value="9">9반</option>
        <option value="10">10반</option>
        <option value="11">11반</option>
        <option value="12">12반</option>
      </select>
      <button type="button" onclick="fetchData()" class="form-button">
        오늘
      </button>
      <button type="button" onclick="fetchWeeklyData()" class="form-button">
        전체
      </button>
    </form>

    <div id="result">
      <h1>시간표</h1>
      <div id="schedule"></div>
      <h1>급식</h1>
      <div id="meal"></div>
    </div>

    <div class="scpg">
      <a href="https://hwahong-h.goesw.kr/index.do" target="_blank" class="scpg"
        >학교홈피</a
      ><a href="https://github.com/Inlayo/hwahong" target="_blank" class="scpg"
        >소스코드</a
      >
    </div>

    <div class="name">10217 이한결</div>

    <script>
      const API_KEY = "34ff04d810454575a10ccfad4024f3b7";
      const EDUCATION_OFFICE_CODE = "J10";
      const SCHOOL_CODE = "7530479";

      document.addEventListener("DOMContentLoaded", () => {
        const savedGrade = localStorage.getItem("grade");
        const savedClassNum = localStorage.getItem("class_num");

        if (savedGrade) {
          document.getElementById("grade").value = savedGrade;
        }

        if (savedClassNum) {
          document.getElementById("class_num").value = savedClassNum;
        }

        const today = new Date();
        const year = today.getFullYear();
        const month = ("0" + (today.getMonth() + 1)).slice(-2);
        const day = ("0" + today.getDate()).slice(-2);
        document.getElementById(
          "current-date"
        ).textContent = `${year}년 ${month}월 ${day}일`;

        if (savedGrade && savedClassNum) {
          fetchData();
        }
      });

      async function fetchData() {
        const grade = document.getElementById("grade").value;
        const classNum = document.getElementById("class_num").value;

        localStorage.setItem("grade", grade);
        localStorage.setItem("class_num", classNum);

        const url = `https://open.neis.go.kr/hub/hisTimetable?ATPT_OFCDC_SC_CODE=${EDUCATION_OFFICE_CODE}&SD_SCHUL_CODE=${SCHOOL_CODE}&AY=2024&ALL_TI_YMD=20240415&GRADE=${grade}&CLASS_NM=${classNum}&KEY=${API_KEY}&Type=json`;

        try {
          const response = await fetch(url);
          const data = await response.json();

          let timetableHtml = "<table><tr><th>교시</th><th>과목</th></tr>";

          if (data.hisTimetable && data.hisTimetable.length > 0) {
            data.hisTimetable[1].row.forEach((item) => {
              timetableHtml += `<tr><td>${item.PERIO}</td><td>${item.ITRT_CNTNT}</td></tr>`;
            });
          } else {
            timetableHtml +=
              "<tr><td colspan='2'>시간표 정보가 없습니다.</td></tr>";
          }

          timetableHtml += "</table>";
          document.getElementById("schedule").innerHTML = timetableHtml;
        } catch (error) {
          document.getElementById("schedule").innerHTML =
            "시간표 정보를 불러오는 중 오류가 발생했습니다.";
        }
      }

      async function fetchWeeklyData() {
        // 주간 시간표 불러오는 기능
      }

      function navigateToDSP() {
        window.location.href = "https://hwahong.pages.dev/DSP";
      }

      function navigateToNEW() {
        window.location.href = "https://hwahong.pages.dev/NEW";
      }
    </script>
  </body>
</html>
